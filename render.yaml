databases:
  - name: foorum-db
    databaseName: jabber
    user: postgres
    plan: free

services:
  - type: web
    name: foorum-api
    env: go
    plan: free
    region: oregon
    rootDir: apps/api
    buildCommand: go build -o server ./cmd/server
    startCommand: ./server
    preDeployCommand: go run github.com/pressly/goose/v3/cmd/goose -dir db/migrations postgres "$DATABASE_URL" up
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: foorum-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: CORS_ORIGINS
        value: https://foorum-web.onrender.com

  - type: static
    name: foorum-web
    plan: free
    region: oregon
    rootDir: .
    buildCommand: pnpm install --filter ./apps/web... --frozen-lockfile && pnpm --filter ./apps/web... build
    staticPublishPath: apps/web/dist
    envVars:
      - key: VITE_API_URL
        value: https://foorum-api.onrender.com
